<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>F√ºr mein Goldl√∂ckchen üíï</title>
    <style>
      :root {
        --accent1: #ff1493;
        --accent2: #ff69b4;
      }
      * { margin:0; padding:0; box-sizing:border-box; }
      body {
        font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
        background: linear-gradient(45deg, #ff69b4, #ff1493, #ff69b4, #ffc0cb);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        min-height: 100vh;
        overflow-x: hidden;
      }
      @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
      .hearts-background { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; overflow:hidden; z-index:1; }
      .floating-heart { position:absolute; font-size:30px; animation:floatUp 8s linear infinite; opacity:.6; }
      @keyframes floatUp { 0% { transform: translateY(100vh) rotate(0); opacity: 0; } 10% { opacity: .6; } 90% { opacity: .6; } 100% { transform: translateY(-100px) rotate(360deg); opacity: 0; } }
      .page { display:none; min-height:100vh; padding:40px 20px; position:relative; z-index:2; }
      .page.active { display:flex; flex-direction:column; align-items:center; justify-content:center; animation:fadeInScale .8s ease-out; }
      @keyframes fadeInScale { from { opacity: 0; transform: scale(.98); } to { opacity: 1; transform: none; } }
      .content-box { background:rgba(255,255,255,.95); border-radius:30px; padding:50px 40px; max-width:900px; width:92%; box-shadow:0 20px 60px rgba(255,105,180,.4),0 0 0 10px rgba(255,192,203,.3),0 0 0 20px rgba(255,192,203,.2); text-align:center; position:relative; }
      h1 { font-size:3.5em; color:var(--accent1); text-shadow:3px 3px 0 #ffc0cb,6px 6px 0 #ff69b4; margin-bottom:20px; animation:heartbeat 2s ease-in-out infinite; }
      @keyframes heartbeat { 0%,100% { transform: scale(1); } 25% { transform: scale(1.1); } 50% { transform: scale(1); } 75% { transform: scale(1.15); } }
      .subtitle { font-size:1.5em; color:var(--accent2); margin-bottom:30px; font-style:italic; }
      .navigation { margin-top:30px; display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }
      .nav-button { background:linear-gradient(135deg,#ffc0cb,#ff69b4); color:white; border:none; padding:15px 30px; font-size:1.1em; font-family:'Comic Sans MS',cursive; border-radius:30px; cursor:pointer; box-shadow:0 5px 15px rgba(255,105,180,.3); transition:all .3s ease; }
      .nav-button:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(255,105,180,.4); }
      .big-button { background:linear-gradient(135deg,#ff1493,#ff69b4); color:white; border:none; padding:20px 50px; font-size:1.5em; font-family:'Comic Sans MS',cursive; border-radius:50px; cursor:pointer; box-shadow:0 10px 30px rgba(255,20,147,.4); transition:all .3s ease; }
      .gallery-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-top:30px; width:100%; }
      .photo-frame { background:white; padding:15px; border-radius:15px; box-shadow:0 10px 30px rgba(255,105,180,.3); transition:transform .3s ease; animation:fadeInScale .5s forwards; opacity:0; overflow:hidden; position:relative; }
      .photo-frame:hover { transform:scale(1.05) rotate(3deg); }
      .photo-frame img,.photo-frame video { width:100%; height:300px; object-fit:cover; border-radius:10px; display:block; }
      .photo-caption { margin-top:10px; font-size:1em; color:var(--accent1); font-weight:bold; }
      .reasons-grid { display:grid; grid-template-columns:1fr; gap:20px; margin-top:30px; text-align:left; }
      .reason-card { background:linear-gradient(135deg,#ffe4f5,#ffd4ea); padding:20px; border-radius:20px; border-left:5px solid var(--accent1); box-shadow:0 5px 15px rgba(255,105,180,.3); animation:fadeInScale .5s forwards; opacity:0; display:flex; align-items:flex-start; }
      .reason-number { font-size:2em; color:var(--accent1); font-weight:bold; margin-right:15px; }
      .reason-text { font-size:1.2em; color:#333; line-height:1.6; }
      /* games */
      .page-box { background:linear-gradient(135deg,#fff5f8,#ffe4f5); padding:30px; border-radius:20px; box-shadow:0 10px 30px rgba(255,105,180,.3); width:100%; margin-bottom:30px; }
      .ttt-board { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; max-width:350px; margin:20px auto; }
      .ttt-cell { aspect-ratio:1; background:#fff; border:3px solid var(--accent2); border-radius:15px; font-size:3em; display:flex; align-items:center; justify-content:center; cursor:pointer; transition: background-color .2s ease, transform .2s ease; color:var(--accent1); font-weight:700; line-height:1; }
      .ttt-status { font-size:1.3em; color:var(--accent1); margin:20px 0; font-weight:700; text-align:center; }
      .ttt-cell.win { box-shadow:0 10px 30px rgba(255,20,147,0.18); transform:scale(1.03); }
      .memory-board { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; max-width:650px; margin:20px auto; }
      .memory-card { aspect-ratio:1; background:#fff; border:3px solid var(--accent2); border-radius:15px; cursor:pointer; position:relative; transform-style:preserve-3d; transition:transform .6s; box-shadow:0 5px 15px rgba(255,105,180,.2); }
      .memory-card.flipped { transform:rotateY(180deg); }
      .memory-card.matched { opacity:.7; pointer-events:none; }
      .card-front,.card-back { position:absolute; width:100%; height:100%; backface-visibility:hidden; border-radius:12px; display:flex; align-items:center; justify-content:center; }
      .card-front { background:linear-gradient(135deg,var(--accent2),var(--accent1)); color:#fff; font-size:2.5em; }
      .card-back { transform:rotateY(180deg); overflow:hidden; }
      .card-back img { width:100%; height:100%; object-fit:cover; border-radius:12px; }
      .soundboard-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:20px; margin-top:20px; }
      .sound-button { background:linear-gradient(135deg, var(--accent2), var(--accent1)); border:none; border-radius:15px; padding:20px; color:white; font-family:'Comic Sans MS',cursive; font-size:1.2em; cursor:pointer; box-shadow:0 5px 15px rgba(0,0,0,0.1); transition:all .2s ease; }
      .voucher-display { background:#fff; border:3px dashed #ff69b4; border-radius:15px; padding:30px; margin-top:20px; min-height:100px; display:flex; align-items:center; justify-content:center; flex-direction: column; font-size:1.3em; color:#333; transition:all .3s ease; }
      /* modal & typewriter */
      #modalOverlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:9999; align-items:center; justify-content:center; }
      #modalCard { background:#fff; padding:26px; border-radius:14px; max-width:720px; width:90%; box-shadow:0 20px 50px rgba(0,0,0,0.25); }
      #typewriter { white-space:pre-wrap; font-size:1.1rem; color:#333; line-height:1.6; }
      /* confetti canvas */
      #confettiCanvas { position:fixed; inset:0; pointer-events:none; z-index:9998; display:block; }
      /* √úberwachungskamera Styles */
      #camContainer { position:relative; width:100%; max-width:800px; background:#000; border-radius:15px; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,0.3); }
      #camVideo { width:100%; display:block; }
      .cam-overlay { position:absolute; top:15px; left:15px; color:white; font-family:monospace; text-shadow:0 0 5px black; z-index:10; display:flex; align-items:center; gap:8px; }
      .rec-dot { width:12px; height:12px; background:red; border-radius:50%; animation:blink 1.5s infinite; }
      @keyframes blink { 0%,100% { opacity:1; } 50% { opacity:0.3; } }
      #camTimestamp { font-size:1.2em; }
      #camGlitchOverlay { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:white; background:rgba(0,0,0,0.7); padding:10px 20px; border-radius:5px; font-family:monospace; font-size:1.5em; z-index:11; display:none; }
      
      /* --- SMOOTH Video-Overlay --- */
      #videoOverlay { position:fixed; inset:0; background:rgba(0,0,0,0); z-index:10000; display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:background-color .6s ease, opacity .6s ease; }
      #videoOverlay.visible { opacity:1; pointer-events:auto; background:rgba(0,0,0,0.9); }
      #fullscreenVideo { position:fixed; object-fit:cover; border-radius:15px; }
      #closeVideoBtn { position:absolute; top:20px; right:20px; font-size:2em; color:white; background:none; border:none; cursor:pointer; text-shadow: 0 0 5px black; opacity:0; transition: opacity .5s ease .5s; }
      #videoOverlay.visible #closeVideoBtn { opacity:1; }

      @media (max-width:768px) {
        h1 { font-size:2.5em; }
        .content-box { padding:30px 20px; }
        .gallery-grid { grid-template-columns:1fr; }
        .memory-board { grid-template-columns:repeat(4,1fr); max-width:100%; gap:8px; }
      }
    </style>
</head>
<body>
    <canvas id="confettiCanvas"></canvas>
    <div class="hearts-background" id="hearts"></div>
    <audio id="letterAudio" src="https://www.dropbox.com/scl/fi/y4vmkitxgrzfk4km7inky/Brief.m4a?rlkey=h2j8l7mfoudot6ftgylkqm4q0&raw=1" preload="auto" crossOrigin="anonymous"></audio>

    <div class="page active" id="page1">
        <div class="content-box">
            <h1>–ü—Ä–∏–≤–µ—Ç Goldl√∂ckchen! üíï</h1>
            <p class="subtitle">Ich hab was Besonderes f√ºr dich gemacht...</p>
            <div style="font-size:5em; margin:30px 0; animation:heartbeat 1.5s ease-in-out infinite;">üíñ</div>
            <p style="font-size:1.3em; color:#ff1493; margin:20px 0;">Entdecke, was ich f√ºr dich vorbereitet habe! üéÄ</p>
            <div class="navigation" style="margin-top:40px;">
                <button class="nav-button" onclick="openModalWithType()">üíå Liebesbrief lesen</button>
                <button class="nav-button" onclick="goToPage(2)">üíñ 10 Gr√ºnde</button>
                <button class="nav-button" onclick="goToPage(3)">üì∏ Unsere Momente</button>
                <button class="nav-button" onclick="goToPage(5)">üéÆ Spiele</button>
                <button class="nav-button" onclick="goToPage(6)">üéÅ F√ºr Dich</button>
                <button class="nav-button" onclick="goToPage(7)">üìπ √úberwachung</button>
            </div>
        </div>
    </div>

    <div class="page" id="page2">
        <div class="content-box" style="max-width:900px">
            <h1>10 Gr√ºnde üíï</h1>
            <p class="subtitle">...warum du die Beste bist!</p>
            <div class="reasons-grid">
                <div class="reason-card"><div class="reason-number">1.</div><div class="reason-text">Ich liebe, wie ruhig und respektvoll du bist ‚Äî neben dir f√ºhle ich mich gelassen und stolz.</div></div>
                <div class="reason-card"><div class="reason-number">2.</div><div class="reason-text">Deine blauen Augen, wenn du mich anschaust, sind tief und machen mich jedes Mal sprachlos.</div></div>
                <div class="reason-card"><div class="reason-number">3.</div><div class="reason-text">Mit dir zu lachen ist eines der sch√∂nsten Dinge ‚Äî du machst selbst kleine Momente magisch.</div></div>
                <div class="reason-card"><div class="reason-number">4.</div><div class="reason-text">Du wei√üt, wie man sich verh√§lt ‚Äî deine Haltung beeindruckt mich, besonders im Vergleich zu vielen anderen.</div></div>
                <div class="reason-card"><div class="reason-number">5.</div><div class="reason-text">Du bist so verletzlich und echt ‚Äî wenn du traurig bist, macht mir das bewusst, wie wichtig unsere Verbindung ist.</div></div>
                <div class="reason-card"><div class="reason-number">6.</div><div class="reason-text">Deine Tiefe beim Blickkontakt gibt mir das Gef√ºhl von Zuhause und Vertrauen.</div></div>
                <div class="reason-card"><div class="reason-number">7.</div><div class="reason-text">Du bringst mich jeden Tag zum Gl√ºcklichsein ‚Äî kleine Dinge mit dir sind gro√ü f√ºr mich.</div></div>
                <div class="reason-card"><div class="reason-number">8.</div><div class="reason-text">Du bist nicht laut, daf√ºr echt ‚Äî und diese Ruhe ist eine St√§rke, die ich sehr bewundere.</div></div>
                <div class="reason-card"><div class="reason-number">9.</div><div class="reason-text">Ich hoffe, unsere Tochter sieht so aus wie du ‚Äî nicht nur wegen deinem Aussehen, sondern wegen deinem Herzen.</div></div>
                <div class="reason-card"><div class="reason-number">10.</div><div class="reason-text">F√ºr mich bist du perfekt, weil du du bist ‚Äî ehrlich, tief und wundersch√∂n.</div></div>
            </div>
            <div class="navigation">
                <button class="nav-button" onclick="goToPage(1)">üè† Start</button>
            </div>
        </div>
    </div>

    <div class="page" id="page3">
        <div class="content-box" style="max-width:1000px">
            <h1>Unsere Momente üíï</h1>
            <p class="subtitle">Erinnerungen die bleiben...</p>
            <div class="gallery-grid">
                <div class="photo-frame"><video id="mainVideo" poster="https://www.dropbox.com/scl/fi/wdjlg1o3oo1jy1b1cjwge/2f294dff-0f53-4a22-9879-f46195354010.mov?rlkey=jaezhtynkx1hyld64z46rzfdx&st=awa8y6jy&raw=1" src="https://www.dropbox.com/scl/fi/wdjlg1o3oo1jy1b1cjwge/2f294dff-0f53-4a22-9879-f46195354010.mov?rlkey=jaezhtynkx1hyld64z46rzfdx&st=awa8y6jy&raw=1" playsinline autoplay muted loop preload="metadata" style="display:block;background:#000"></video><div class="photo-caption">Mein strahlender Stern ‚≠ê</div></div>
                <div class="photo-frame"><img src="https://www.dropbox.com/scl/fi/60mc4feiolv77mn6p3gpg/IMG_0977.png?rlkey=xbpocc1q7iphtwygkwwfv3n8c&st=m7044oyh&raw=1" alt="Foto 2"><div class="photo-caption">Zusammen üíë</div></div>
                <div class="photo-frame"><img src="https://www.dropbox.com/scl/fi/6jg2e5wz54xgflp3xd5dr/IMG_9951.jpeg?rlkey=nyp61dz4f7c47pi73q0gvf4ts&st=drdtq9ca&raw=1" alt="Foto 3"><div class="photo-caption">Unvergesslich üíù</div></div>
                <div class="photo-frame"><img src="https://www.dropbox.com/scl/fi/r37jie65l4eh0wdhousyv/IMG_0978.jpeg?rlkey=s8nfzbr3ckddd95wi8zwpgijk&st=sbue1nr8&raw=1" alt="Foto 4"><div class="photo-caption">Meine kleine Prinzessin üíñ</div></div>
            </div>
            <div class="navigation">
                <button class="nav-button" onclick="goToPage(1)">üè† Start</button>
            </div>
        </div>
    </div>

    <div class="page" id="page5">
        <div class="content-box" style="max-width:1000px">
            <h1>Spiele & Spa√ü üíï</h1>
            <p class="subtitle">Ein bisschen Zeitvertreib nur f√ºr dich üòä</p>
            <div class="page-box">
                <h2>Memory - Unsere Fotos üì∏</h2>
                <div class="memory-stats" style="display:flex;justify-content:space-around;margin:8px 0;color:var(--accent1)">
                    <div>Z√ºge: <strong id="memoryMoves">0</strong></div>
                    <div>Paare: <strong id="memoryPairs">0</strong>/16</div>
                    <div>Best: <strong id="memoryBest">‚Äî</strong></div>
                </div>
                <div id="memoryBoard" class="memory-board"></div>
                <button class="nav-button" onclick="resetMemory()">Neues Spiel</button>
            </div>
            <div class="page-box">
                <h2>Tic Tac Toe üíñ</h2>
                <div class="ttt-status" id="tttStatus">Du bist X - Starte das Spiel!</div>
                <div id="tttBoard" class="ttt-board"></div>
                <button class="nav-button" onclick="resetTicTacToe()">Neues Spiel</button>
            </div>
            <div class="navigation">
                <button class="nav-button" onclick="goToPage(1)">üè† Start</button>
            </div>
        </div>
    </div>

    <div class="page" id="page6">
        <div class="content-box" style="max-width:1000px">
            <h1>Ein paar Kleinigkeiten... üíï</h1>
            <p class="subtitle">...nur f√ºr dich, mein Goldl√∂ckchen.</p>
            <div class="page-box">
                <h2>üéôÔ∏è Eine Nachricht von mir</h2>
                <p style="margin-bottom:20px;">Wenn du meine Stimme h√∂ren willst...</p>
                <div id="soundGrid" class="soundboard-grid"></div>
            </div>
            <div class="page-box">
                <h2>üéüÔ∏è Dein t√§glicher Gutschein</h2>
                <p>Klick f√ºr einen zuf√§lligen Gutschein (nur 1x alle 24h)!</p>
                <div id="voucherDisplay" class="voucher-display"><p>Hier wartet eine √úberraschung...</p></div>
                <button id="generateVoucherBtn" class="big-button">Gutschein generieren ‚ú®</button>
            </div>
             <div class="page-box">
                <h2>üíå Wunschbox f√ºr die Zukunft</h2>
                <p>Was w√ºnschst du dir f√ºr uns? (Nur ich kann das lesen!)</p>
                <div class="wish-box" style="width:100%;max-width:520px;margin:0 auto">
                    <textarea id="wishText" placeholder="Schreib hier, was dein Herz bewegt..." style="width:100%;min-height:120px;padding:15px;border:2px solid #ffc0cb;border-radius:15px;font-family:'Comic Sans MS'"></textarea>
                    <button class="big-button" onclick="submitWish()" style="margin-top:12px">Wunsch abschicken üíñ</button>
                </div>
            </div>
            <div class="navigation">
                <button class="nav-button" onclick="goToPage(1)">üè† Start</button>
            </div>
        </div>
    </div>

    <div class="page" id="page7">
        <div class="content-box">
            <h1>üìπ Live √úberwachung</h1>
            <p class="subtitle">Ich hab immer ein Auge auf dich... üòâ</p>
            <div id="camContainer">
                <video id="camVideo" src="https://www.dropbox.com/scl/fi/28fttvo95du62gnt0owr8/IMG_0996.mov?rlkey=veuo8dsf7t2me23eucj62yadj&raw=1" autoplay loop muted playsinline></video>
                <div class="cam-overlay">
                    <div class="rec-dot"></div>
                    <div id="camTimestamp">LIVE</div>
                </div>
                <div id="camGlitchOverlay">VERBINDUNG SCHWACH...</div>
            </div>
            <div class="navigation">
                <button class="nav-button" onclick="goToPage(1)">üè† Start</button>
            </div>
        </div>
    </div>

    <div id="modalOverlay" onclick="closeModal()">
        <div id="modalCard" onclick="event.stopPropagation()">
            <div id="typewriter"></div>
            <div style="text-align:right; margin-top:14px;">
                <button class="nav-button" onclick="closeModal()">Schlie√üen</button>
            </div>
        </div>
    </div>

    <div id="videoOverlay">
        <video id="fullscreenVideo" src="" playsinline></video>
        <button id="closeVideoBtn" onclick="closeFullscreenVideo(event)">√ó</button>
    </div>

<script>
    /* ---------------------------------
       SETUP & GLOBAL HELPERS
    --------------------------------- */
    (function createHearts() {
        const container = document.getElementById('hearts');
        if (!container) return;
        const hearts = ['üíï','üíñ','üíó','üíù','üíò','‚ù§Ô∏è','üíì'];
        setInterval(() => {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
            heart.style.left = Math.random() * 100 + '%';
            heart.style.animationDuration = (Math.random() * 3 + 5) + 's';
            container.appendChild(heart);
            setTimeout(() => heart.remove(), 8000);
        }, 300);
    })();

    function goToPage(pageNumber) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const page = document.getElementById('page' + pageNumber);
        if (page) page.classList.add('active');
        window.scrollTo(0, 0);
        if (pageNumber === 7) { startCam(); } 
        else { stopCam(); }
    }
    
    /* ---------------------------------
       CONFETTI
    --------------------------------- */
    const confettiCanvas = document.getElementById('confettiCanvas');
    const ctx = confettiCanvas.getContext('2d');
    let confetti = [];
    function resizeCanvas() { if (confettiCanvas) { confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; } }
    function spawnConfetti(amount = 80) {
        const colors = ['#ff69b4', '#ff1493', '#ffc0cb', '#fff176'];
        for (let i = 0; i < amount; i++) { confetti.push({ x: Math.random() * confettiCanvas.width, y: -20 - Math.random() * 100, vx: (Math.random() - 0.5) * 6, vy: 2 + Math.random() * 6, size: 6 + Math.random() * 10, angle: Math.random() * 360, spin: (Math.random() - 0.5) * 0.2, color: colors[Math.floor(Math.random() * colors.length)], gravity: 0.04 + Math.random() * 0.08 }); }
    }
    function updateConfetti() {
        if (!ctx) return;
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        for (let i = confetti.length - 1; i >= 0; i--) {
            const p = confetti[i];
            p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.angle += p.spin;
            ctx.save();
            ctx.translate(p.x, p.y); ctx.rotate(p.angle);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 0.6);
            ctx.restore();
            if (p.y > confettiCanvas.height + 50 || p.x < -100 || p.x > confettiCanvas.width + 100) { confetti.splice(i, 1); }
        }
        requestAnimationFrame(updateConfetti);
    }

    /* ---------------------------------
       TYPEWRITER MODAL & VOICED LETTER
    --------------------------------- */
    const modalOverlay = document.getElementById('modalOverlay');
    const typeEl = document.getElementById('typewriter');
    const letterAudioElement = document.getElementById('letterAudio');
    const letterLines = ["Canim benim,","","Diese kleine Reise durch unsere Website ist wie ein kleines Abbild davon, was du f√ºr mich bedeutest. Jede Seite, jedes Wort, jedes Herz das hier schwebt ‚Äî all das kann nicht ansatzweise ausdr√ºcken, wie besonders du f√ºr mich bist.","Du machst mein Leben bunter, sch√∂ner und voller Liebe. Dein L√§cheln ist das Sch√∂nste, was ich je gesehen habe, und dein Strahlen erhellt selbst die dunkelsten Tage.","Vergiss nicht, Wasser zu trinken und auf dich aufzupassen ‚Äî denn du bist wertvoll und verdienst nur das Beste! üíß‚≠ê","","Seni cok seviyorum","","Dein Berkem ‚ù§Ô∏è"];
    let isTyping = false;
    let letterAudioContext, letterAudioSourceNode;

    function setupAudioContext() {
        if (letterAudioContext || !letterAudioElement) return;
        try {
            letterAudioContext = new (window.AudioContext || window.webkitAudioContext)();
            const bandpass = letterAudioContext.createBiquadFilter();
            bandpass.type = 'bandpass';
            bandpass.frequency.value = 1500;
            bandpass.Q.value = 0.9;
            letterAudioSourceNode = letterAudioContext.createMediaElementSource(letterAudioElement);
            letterAudioSourceNode.connect(bandpass).connect(letterAudioContext.destination);
        } catch (e) { console.error("Web Audio API konnte nicht initialisiert werden.", e); }
    }

    function openModalWithType() {
        if (isTyping) return;
        setupAudioContext();
        if (letterAudioContext && letterAudioContext.state === 'suspended') { letterAudioContext.resume(); }
        letterAudioElement.currentTime = 0;
        letterAudioElement.play().catch(e => console.error("Audio konnte nicht starten:", e));
        modalOverlay.style.display = 'flex';
        typeEl.innerHTML = '';
        isTyping = true;
        let lineIndex = 0; let charIndex = 0;
        function type() {
            if (lineIndex >= letterLines.length) { isTyping = false; return; }
            if (charIndex < letterLines[lineIndex].length) {
                typeEl.innerHTML += letterLines[lineIndex].charAt(charIndex);
                charIndex++;
                setTimeout(type, 50);
            } else {
                typeEl.innerHTML += '<br>';
                lineIndex++; charIndex = 0;
                setTimeout(type, 300);
            }
        }
        type();
    }

    function closeModal() {
        if (modalOverlay) modalOverlay.style.display = 'none';
        isTyping = false;
        if (letterAudioElement) { letterAudioElement.pause(); letterAudioElement.currentTime = 0; }
    }
    
    /* ---------------------------------
       FULLSCREEN VIDEO PLAYER
    --------------------------------- */
    const videoOverlay = document.getElementById('videoOverlay');
    const fullscreenVideo = document.getElementById('fullscreenVideo');

    function openFullscreenVideo(event, videoUrl) {
        const button = event.currentTarget;
        button.style.opacity = '0.5'; // Visuelles Feedback, dass etwas passiert
        
        fullscreenVideo.src = videoUrl;
        fullscreenVideo.load();

        fullscreenVideo.oncanplay = () => {
            button.style.opacity = '1';
            const rect = button.getBoundingClientRect();
            fullscreenVideo.style.transition = 'none';
            fullscreenVideo.style.left = `${rect.left}px`;
            fullscreenVideo.style.top = `${rect.top}px`;
            fullscreenVideo.style.width = `${rect.width}px`;
            fullscreenVideo.style.height = `${rect.height}px`;
            fullscreenVideo.style.borderRadius = '15px';
            videoOverlay.classList.add('visible');
            
            requestAnimationFrame(() => {
                fullscreenVideo.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                fullscreenVideo.style.left = '50%';
                fullscreenVideo.style.top = '50%';
                fullscreenVideo.style.width = 'auto';
                fullscreenVideo.style.height = '90vh';
                fullscreenVideo.style.transform = 'translate(-50%, -50%)';
            });

            fullscreenVideo.play().catch(e => console.error("Video konnte nicht starten:", e));
            fullscreenVideo.oncanplay = null; // Event Listener entfernen
        };
    }

    function closeFullscreenVideo(event) {
        event.stopPropagation();
        videoOverlay.classList.remove('visible');
        fullscreenVideo.pause();
        fullscreenVideo.currentTime = 0;
    }
    videoOverlay.addEventListener('click', (e) => closeFullscreenVideo(e));

    /* ---------------------------------
       PAGE 6: FOR YOU FEATURES
    --------------------------------- */
    const sounds = [
        { label:'Guten Morgen ‚òÄÔ∏è', src:'https://www.dropbox.com/scl/fi/v01pflmr74lrmh68embd2/Guten-Morgen.m4a?rlkey=0xqcm8ar4nmj46lw4ro24yvwo&raw=1' },
        { label:'Ihhh! üòÇ', src:'https://www.dropbox.com/scl/fi/3ntrgdprjmkzm7osi2aen/Ihhh.m4a?rlkey=hgcu0nhpx0v5c868aeq3j69yb&raw=1' },
        { label:'Wasser trinken! üíß', src:'https://www.dropbox.com/scl/fi/6c7378rsbhz3vvoo5fb41/Wasser.m4a?rlkey=ggd2zzun4juihz06q9tcutmi0&raw=1' },
        { label:'Wenn du traurig bist', isVideo: true, src: 'https://www.dropbox.com/scl/fi/nqdjpxxyrauexpuf046m2/copy_97A5B45E-501D-470F-A2F7-2C5AE2525488.mov?rlkey=1vuejhh8n0av6a5b4wjg3lja8&raw=1' }
    ];
    let audioElems = {};
    let currentAudios = [];

    function initSoundboard() {
        const soundGrid = document.getElementById('soundGrid');
        if (!soundGrid) return;
        soundGrid.innerHTML = '';
        sounds.forEach(sound => {
            const btn = document.createElement('button');
            btn.className = 'sound-button';
            btn.textContent = sound.label;
            
            if (sound.isVideo) {
                btn.onclick = (event) => {
                    currentAudios.forEach(a => { a.pause(); a.currentTime = 0; });
                    currentAudios = [];
                    openFullscreenVideo(event, sound.src);
                };
            } else {
                const voiceAudio = new Audio(sound.src);
                voiceAudio.preload = 'auto';
                audioElems[sound.label] = { voice: voiceAudio };
                btn.onclick = () => {
                    currentAudios.forEach(a => { a.pause(); a.currentTime = 0; });
                    currentAudios = [];
                    const soundPair = audioElems[sound.label];
                    soundPair.voice.currentTime = 0;
                    soundPair.voice.play().catch(e => console.error("Voice audio failed:", e));
                    currentAudios.push(soundPair.voice);
                };
            }
            soundGrid.appendChild(btn);
        });
    }

    const vouchers = ["Ein gemeinsamer Kochabend... üçù","Ein Film-Marathon... üé¨","Eine 20-Minuten R√ºckenmassage... üíÜ‚Äç‚ôÄÔ∏è","Ein Ausflug an einen neuen Ort... üöó","Ein Nachmittag nur kuscheln... ‚ù§Ô∏è","Ich erledige eine Aufgabe f√ºr dich... üòâ","Ein Gutschein f√ºr ein gro√ües Eis... üç¶"];
    const generateVoucherBtn = document.getElementById('generateVoucherBtn');
    if (generateVoucherBtn) {
        generateVoucherBtn.addEventListener('click', () => {
            const lastTime = localStorage.getItem('lastVoucherTime');
            if (lastTime && (Date.now() - Number(lastTime)) < 24 * 60 * 60 * 1000) {
                alert("Du hast heute schon einen Gutschein bekommen, mein Schatz! ü•∞\nVersuch es morgen wieder.");
                return;
            }
            const voucherText = vouchers[Math.floor(Math.random() * vouchers.length)];
            const display = document.getElementById('voucherDisplay');
            if(display) display.innerHTML = `<p>${voucherText}</p>`;
            localStorage.setItem('lastVoucherTime', String(Date.now()));
            spawnConfetti(80);
        });
    }
    
    function submitWish() {
        const wishText = document.getElementById('wishText').value;
        if (wishText.trim() === "") { alert("Du hast nichts eingegeben, mein Schatz! üòä"); return; }
        alert("üíñ Dein Wunsch wurde an mein Herz gesendet und wird dort sicher aufbewahrt. Danke f√ºr dein Vertrauen! üíñ");
        document.getElementById('wishText').value = "";
    }

    /* ---------------------------------
       PAGE 5: GAMES (Full logic restored)
    --------------------------------- */
    let tttBoardState, tttCurrentPlayer, tttIsGameOver;
    function initTicTacToe() {
        const board = document.getElementById('tttBoard');
        if (!board) return;
        board.innerHTML = '';
        tttBoardState = Array(9).fill(null);
        tttCurrentPlayer = 'X';
        tttIsGameOver = false;
        for (let i = 0; i < 9; i++) {
            const cell = document.createElement('div');
            cell.className = 'ttt-cell';
            cell.dataset.index = i;
            cell.addEventListener('click', handleTttClick);
            board.appendChild(cell);
        }
        document.getElementById('tttStatus').textContent = 'Du bist X - Starte das Spiel';
    }
    function handleTttClick(e) {
        const index = Number(e.currentTarget.dataset.index);
        if (tttBoardState[index] || tttIsGameOver) return;
        tttBoardState[index] = tttCurrentPlayer;
        e.currentTarget.textContent = tttCurrentPlayer;
        const winInfo = checkTttWin();
        if (winInfo) {
            tttIsGameOver = true;
            document.getElementById('tttStatus').textContent = `${tttCurrentPlayer} hat gewonnen! üéâ`;
            winInfo.line.forEach(i => document.querySelector(`.ttt-cell[data-index='${i}']`).classList.add('win'));
            spawnConfetti(60);
        } else if (!tttBoardState.includes(null)) {
            tttIsGameOver = true;
            document.getElementById('tttStatus').textContent = 'Unentschieden! ü§ù';
        } else {
            tttCurrentPlayer = tttCurrentPlayer === 'X' ? 'O' : 'X';
            document.getElementById('tttStatus').textContent = `${tttCurrentPlayer} ist dran!`;
        }
    }
    function checkTttWin() {
        const winConditions = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        for(const line of winConditions) {
            if (line.every(index => tttBoardState[index] === tttCurrentPlayer)) return { line };
        }
        return null;
    }
    function resetTicTacToe() { initTicTacToe(); }

    const memoryImages = ['https://www.dropbox.com/scl/fi/whqfbo5uk5n2fa0zqkjx0/IMG_0981.jpeg?rlkey=ujtsc8cepnyrjsgpxmv3vveez&raw=1','https://www.dropbox.com/scl/fi/ihfu435pe1snavg8szyla/IMG_0982.png?rlkey=rtgdopio3jn0bh3in1nv0p965&raw=1','https://www.dropbox.com/scl/fi/8ukwb5gf4zq8obd6k28a1/IMG_0985.jpeg?rlkey=bt40tt7jnelgmbbwxg0f3kdtd&raw=1','https://www.dropbox.com/scl/fi/dk5ctsrwwbj07cc51r9aw/IMG_0986.jpeg?rlkey=f2iix5n8437fe8uc3wlvo60or&raw=1','https://www.dropbox.com/scl/fi/0wrs9zgt0vav6uvp6btpl/IMG_0987.jpeg?rlkey=hj5m4ukcax4kyniogot6k9wdb&raw=1','https://www.dropbox.com/scl/fi/tq7s6n3fsful5tw55cw40/IMG_0988.jpeg?rlkey=1s3kt4allgkztzorxwqdmqhrf&raw=1','https://www.dropbox.com/scl/fi/nxu1l76noiydv1bb0gxj7/IMG_9449.jpeg?rlkey=v5rx82tbcsve5qfoqpu82pn4g&raw=1','https://www.dropbox.com/scl/fi/uwfryulzvb0ir56vncxx1/IMG_9448.jpeg?rlkey=lkajz4i06yatlqldqzk4dl3ck&raw=1','https://www.dropbox.com/scl/fi/9stnfacqwl1w32wcq19t9/d3160c6d-f4e5-47dc-9114-3cb7ab064a2a.jpeg?rlkey=eya5vzn2zo3w41tl17un5q35r&raw=1','https://www.dropbox.com/scl/fi/gj851xu873nyzqq05xtzh/310fa297-4cf0-4577-8bab-be0276fe691c.jpeg?rlkey=kk0pi5n6ji72uvxa5xy462zfn&raw=1','https://www.dropbox.com/scl/fi/qu3kls1fdzhde79sd1gvk/IMG_9605.jpeg?rlkey=xdoc9eou82utnp5gq72o6tsct&raw=1','https://www.dropbox.com/scl/fi/fdpjzhyl9asyv88gqefau/8eee828d-91a3-47a3-9dbc-18959e4cfb47.jpeg?rlkey=gpuafexs1l8yx06hvzsggevp1&raw=1','https://www.dropbox.com/scl/fi/9xqs4znvowzaprznoxz02/38775D46-1064-4082-A4FC-D2EC50110488.png?rlkey=6g9xkazc8q065ewjf22s3xqfy&raw=1','https://www.dropbox.com/scl/fi/h38vvqt7tn58a3buho326/b26d9865-5eb8-4679-a049-fd2a539d056d.jpeg?rlkey=6qlhuci8u8io5t5ylli9i7s4h&raw=1','https://www.dropbox.com/scl/fi/ua93egtyr50o08cuozo25/1DF7285F-76E6-4449-97BB-52A14D6FD8CE.jpeg?rlkey=qqdftbt7b16m67ppn0xlhrxmy&raw=1','https://www.dropbox.com/scl/fi/f1plwpzhk751vfnsc48rp/612420c9-1e5e-4a02-aca8-2e3595d9e7d8.jpeg?rlkey=tvr3e55oiaon8ykpwkaeog0gl&raw=1'];
    let memoryCards, flippedCards, matchedPairs, moves, canFlip;
    function initMemory() {
        const board = document.getElementById('memoryBoard');
        if (!board) return;
        board.innerHTML = '';
        const cardsData = [];
        memoryImages.forEach((img, i) => { cardsData.push({img, id:i}); cardsData.push({img, id:i}); });
        memoryCards = cardsData.sort(() => Math.random() - 0.5);
        flippedCards = []; matchedPairs = []; moves = 0; canFlip = true;
        document.getElementById('memoryMoves').textContent = '0';
        document.getElementById('memoryPairs').textContent = '0';
        const best = Number(localStorage.getItem('memoryBest') || 0);
        document.getElementById('memoryBest').textContent = best ? `${best} Z√ºge` : '‚Äî';
        memoryCards.forEach((cardData, index) => {
            const cardEl = document.createElement('div');
            cardEl.className = 'memory-card';
            cardEl.dataset.index = index;
            cardEl.innerHTML = `<div class="card-front">üíñ</div><div class="card-back"><img src="${cardData.img}" alt="Foto"></div>`;
            cardEl.addEventListener('click', () => handleMemoryClick(cardEl, index));
            board.appendChild(cardEl);
        });
    }
    function handleMemoryClick(cardEl, index) {
        if (!canFlip || cardEl.classList.contains('flipped') || cardEl.classList.contains('matched')) return;
        cardEl.classList.add('flipped');
        flippedCards.push({ element: cardEl, index });
        if (flippedCards.length === 2) {
            canFlip = false;
            moves++;
            document.getElementById('memoryMoves').textContent = moves;
            setTimeout(checkMatch, 900);
        }
    }
    function checkMatch() {
        const [a, b] = flippedCards;
        const isMatch = memoryCards[a.index].id === memoryCards[b.index].id;
        if (isMatch) {
            a.element.classList.add('matched');
            b.element.classList.add('matched');
            matchedPairs.push(a.index, b.index);
            document.getElementById('memoryPairs').textContent = matchedPairs.length / 2;
            if (matchedPairs.length / 2 === memoryImages.length) {
                setTimeout(() => {
                    alert(`üéâ Gewonnen in ${moves} Z√ºgen! Du bist gro√üartig, Goldl√∂ckchen! üíñ`);
                    spawnConfetti(80);
                    const best = Number(localStorage.getItem('memoryBest') || 0);
                    if (best === 0 || moves < best) {
                        localStorage.setItem('memoryBest', String(moves));
                        document.getElementById('memoryBest').textContent = `${moves} Z√ºge`;
                        alert('Neuer Bestwert! ‚ù§Ô∏è');
                    }
                }, 400);
            }
        } else {
            a.element.classList.remove('flipped');
            b.element.classList.remove('flipped');
        }
        flippedCards = [];
        canFlip = true;
    }
    function resetMemory() { initMemory(); }

    /* ---------------------------------
       SURVEILLANCE CAM LOGIC
    --------------------------------- */
    const camVideo = document.getElementById('camVideo'), camTimestamp = document.getElementById('camTimestamp'), camGlitchOverlay = document.getElementById('camGlitchOverlay');
    let camInterval, glitchInterval;
    function updateTimestamp() { if (camTimestamp) camTimestamp.textContent = `LIVE ${new Date().toLocaleTimeString('de-DE')}`; }
    function triggerGlitch() {
        if (!camVideo || !camGlitchOverlay || camVideo.duration < 1) return;
        const r = Math.random();
        if (r < 0.4) { camVideo.currentTime = Math.random() * camVideo.duration; }
        else if (r < 0.8) { camGlitchOverlay.style.display = 'block'; camVideo.pause(); setTimeout(() => { camGlitchOverlay.style.display = 'none'; camVideo.play().catch(()=>{}); }, 1500); }
        else { camVideo.playbackRate = 3.0; setTimeout(() => { if(camVideo) camVideo.playbackRate = 1.0; }, 700); }
    }
    function startCam() { if (camVideo) camVideo.play().catch(()=>{}); camInterval = setInterval(updateTimestamp, 1000); glitchInterval = setInterval(triggerGlitch, 7000); }
    function stopCam() { if (camVideo) camVideo.pause(); clearInterval(camInterval); clearInterval(glitchInterval); }

    /* ---------------------------------
       INITIALIZE ON LOAD
    --------------------------------- */
    document.addEventListener('DOMContentLoaded', () => {
        initTicTacToe();
        initMemory();
        initSoundboard();
        resizeCanvas();
        updateConfetti();
        
        const mainVideo = document.getElementById('mainVideo');
        if (mainVideo) {
            mainVideo.play().catch(() => {});
            let lastTap = 0;
            mainVideo.addEventListener('click', () => {
                const now = Date.now();
                if (now - lastTap < 300) { mainVideo.muted = !mainVideo.muted; }
                else { if (mainVideo.paused) mainVideo.play().catch(() => {}); else mainVideo.pause(); }
                lastTap = now;
            });
        }
    });
</script>
</body>
</html>
